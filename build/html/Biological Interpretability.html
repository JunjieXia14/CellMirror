<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biological Interpretability &mdash; CellMirror v1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Step0: Loading packages (Python)" href="Integrating%20ST%20and%20scRNA-seq%20Data.html" />
    <link rel="prev" title="Alignment of Tumors and Cell Lines" href="Alignment%20of%20Tumors%20and%20Cell%20Lines.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CellMirror
              <img src="_static/CellMirror_icon.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install CellMirror</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html#id1">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Alignment%20of%20Tumors%20and%20Cell%20Lines.html">Alignment of Tumors and Cell Lines</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Biological Interpretability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#kernal-density-plot-of-features-and-related-genes-python">Kernal density plot of features and related genes (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gene-set-enrichment-analysis-for-extracted-features-r">Gene set enrichment analysis for extracted features (R)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scatter-plot-between-salient-features-and-tumor-purity-r">Scatter plot between salient features and tumor purity (R)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html">Step0: Loading packages (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#step1-reading-and-preprocessing-data-python">Step1: Reading and preprocessing data (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#step2-training-cldvae-model-python">Step2: Training cLDVAE model (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#step3-saving-cldvae-outputs-python">Step3: Saving cLDVAE outputs (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#step4-implementing-mnn-on-the-processed-data-r">Step4: Implementing MNN on the processed data (R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#step5-saving-results-aligned-by-cellmirror-r">Step5: Saving results aligned by CellMirror (R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#step6-visualization-r">Step6: Visualization (R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id2">Step0: Loading packages (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id3">Step1: Reading and preprocessing data (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id4">Step2: Training cLDVAE model (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id5">Step3: Saving cLDVAE outputs (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id6">Step4: Implementing MNN on the processed data (R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id7">Step5: Saving results aligned by CellMirror (R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integrating%20ST%20and%20scRNA-seq%20Data.html#id8">Step6: Visualization (R)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CellMirror</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Biological Interpretability</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Biological Interpretability.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="biological-interpretability">
<h1>Biological Interpretability<a class="headerlink" href="#biological-interpretability" title="Permalink to this heading"></a></h1>
<p>In this tutorial, we will show how to explain the extracted features using CellMirror feature embeddings and linear decoder weights of cLDVAE.
We continue with the previous example of tumros and cell lines data integration.</p>
<section id="kernal-density-plot-of-features-and-related-genes-python">
<h2>Kernal density plot of features and related genes (Python)<a class="headerlink" href="#kernal-density-plot-of-features-and-related-genes-python" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="linenos">  2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="linenos">  4</span><span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="n">Z_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;en[1000]_de[1000]_cLDVAE_only_TCGA_salient_features_lr3e-06_beta1_gamma-100_bs128_dim2_time2023-03-22 12_31_29.044376.csv&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">  7</span><span class="n">W_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;en[1000]_de[1000]_cLDVAE_only_salient_loadings_matrix_lr3e-06_beta1_gamma-100_bs128_time2023-03-22 12_31_29.075603.csv&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="k">def</span> <span class="nf">Z_covariance</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
<span class="linenos"> 10</span>    <span class="n">Zcentered</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">-</span> <span class="n">Z</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 11</span>    <span class="n">Zscaled</span> <span class="o">=</span> <span class="n">Zcentered</span> <span class="o">/</span> <span class="n">Z</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 12</span>    <span class="n">ZTZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">Zscaled</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="linenos"> 13</span>
<span class="linenos"> 14</span>    <span class="n">eigen_values</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">ZTZ</span><span class="p">)</span>
<span class="linenos"> 15</span>    <span class="n">singular_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigen_values</span><span class="p">)</span>
<span class="linenos"> 16</span>    <span class="n">variance_explained</span> <span class="o">=</span> <span class="n">singular_values</span> <span class="o">/</span> <span class="n">singular_values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>    <span class="k">return</span> <span class="n">ZTZ</span><span class="p">,</span> <span class="n">variance_explained</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="n">_</span><span class="p">,</span> <span class="n">variance_explained</span> <span class="o">=</span> <span class="n">Z_covariance</span><span class="p">(</span><span class="n">Z_df</span><span class="p">)</span>
<span class="linenos"> 21</span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">variance_explained</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="n">variance_explained_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;variance_explained&#39;</span><span class="p">:</span><span class="n">variance_explained</span><span class="p">[</span><span class="n">idx</span><span class="p">]},</span><span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="n">Z_df_ordered</span> <span class="o">=</span> <span class="n">Z_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span>
<span class="linenos"> 26</span><span class="n">W_df_ordered</span> <span class="o">=</span> <span class="n">W_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="n">gene_stats</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;common_HVGs_noScale_stats_SD_mean_time2023-01-20 13_48_31.884973.csv&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="n">W_df_ordered</span> <span class="o">=</span> <span class="n">W_df_ordered</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">gene_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">W_df_ordered</span><span class="o">.</span><span class="n">index</span><span class="p">,[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="n">text_shift</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGHG1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 33</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGHG4&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
<span class="linenos"> 34</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ALDOB&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 35</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGHG2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
<span class="linenos"> 36</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGKC&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 37</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGHGP&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
<span class="linenos"> 38</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGKV2-28&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
<span class="linenos"> 39</span>           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;IGKV1D-39&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">}</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>    <span class="c1"># -- tg_s plot --</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span>    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
<span class="linenos"> 52</span>        <span class="n">Z_df_ordered</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;s</span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">Z_df_ordered</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;s</span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
<span class="linenos"> 53</span>        <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
<span class="linenos"> 54</span>        <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">PowerNorm</span><span class="p">(</span><span class="mf">0.25</span><span class="p">),</span>
<span class="linenos"> 55</span>        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span>
<span class="linenos"> 56</span>        <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos"> 57</span>    <span class="p">)</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
<span class="linenos"> 60</span>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cLDVAE salient feature </span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">variance_explained_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">% variance)&#39;</span><span class="p">)</span>
<span class="linenos"> 61</span>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cLDVAE salient feature </span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">variance_explained_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">% variance)&#39;</span><span class="p">)</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="linenos"> 64</span>    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 65</span>    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>    <span class="c1"># -- W plot --</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>    <span class="n">w_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;s</span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;s</span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>    <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
<span class="linenos"> 74</span>        <span class="n">W_df_ordered</span><span class="p">[</span><span class="n">w_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">W_df_ordered</span><span class="p">[</span><span class="n">w_columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
<span class="linenos"> 75</span>        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues_r&#39;</span><span class="p">,</span>
<span class="linenos"> 76</span>        <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos"> 77</span>    <span class="p">)</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
<span class="linenos"> 80</span>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Salient feature </span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">21</span><span class="p">})</span>
<span class="linenos"> 81</span>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Salient feature </span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">21</span><span class="p">})</span>
<span class="linenos"> 82</span>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="linenos"> 83</span>    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>    <span class="n">tmp_</span> <span class="o">=</span> <span class="n">W_df_ordered</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 86</span>    <span class="n">tmp_</span><span class="p">[</span><span class="s1">&#39;lnth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tmp_</span><span class="p">[</span><span class="n">w_columns</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>    <span class="n">ggg</span><span class="o">=</span><span class="n">tmp_</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;lnth&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">8</span><span class="p">)[[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;lnth&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">w_columns</span><span class="p">]]</span>
<span class="linenos"> 89</span>    <span class="nb">print</span><span class="p">(</span><span class="n">ggg</span><span class="p">[[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">w_columns</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>    <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 92</span>    <span class="n">arrows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 93</span>    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ggg</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="linenos"> 94</span>        <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">w_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">r</span><span class="p">[</span><span class="n">w_columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>        <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
<span class="linenos"> 97</span>        <span class="k">if</span> <span class="n">x_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 98</span>            <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span>        <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
<span class="linenos">101</span>        <span class="k">if</span> <span class="n">y_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">102</span>            <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
<span class="linenos">103</span>
<span class="linenos">104</span>        <span class="n">arrows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="linenos">105</span>
<span class="linenos">106</span>        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="linenos">107</span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="ow">in</span> <span class="n">text_shift</span><span class="p">:</span>
<span class="linenos">108</span>            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">text_shift</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">symbol</span><span class="p">)]</span>
<span class="linenos">109</span>            <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_</span> <span class="o">+</span> <span class="n">xs</span><span class="p">,</span> <span class="n">y_</span> <span class="o">+</span> <span class="n">ys</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">}))</span>
<span class="linenos">110</span>
<span class="linenos">111</span>    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="linenos">112</span>    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">113</span>    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos">114</span>    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">115</span>    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos">116</span>
<span class="linenos">117</span><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Biological_interpretability_kernal.jpg" src="_images/Biological_interpretability_kernal.jpg" />
</section>
<section id="gene-set-enrichment-analysis-for-extracted-features-r">
<h2>Gene set enrichment analysis for extracted features (R)<a class="headerlink" href="#gene-set-enrichment-analysis-for-extracted-features-r" title="Permalink to this heading"></a></h2>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nf">library</span><span class="p">(</span><span class="n">here</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="nf">source</span><span class="p">(</span><span class="n">here</span><span class="o">::</span><span class="nf">here</span><span class="p">(</span><span class="s">&#39;CellMirror_utils&#39;</span><span class="p">,</span><span class="s">&#39;CellMirror_methods.R&#39;</span><span class="p">))</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">s.loadings</span><span class="o">&lt;-</span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;C:\\Users\\我的电脑\\Desktop\\待办\\en[1000]_de[1000]_cLDVAE_only_salient_loadings_matrix_lr3e-06_beta1_gamma-100_bs128_time2023-03-22 12_31_29.075603.csv&#39;</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="n">gene_stats</span><span class="o">&lt;-</span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;C:\\Users\\我的电脑\\Desktop\\待办\\common_HVGs_noScale_stats_SD_mean_time2023-01-20 13_48_31.884973.csv&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="nf">colnames</span><span class="p">(</span><span class="n">s.loadings</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="s">&#39;ensembl_gene_id&#39;</span>
<span class="linenos"> 9</span><span class="nf">colnames</span><span class="p">(</span><span class="n">gene_stats</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="s">&#39;ensembl_gene_id&#39;</span>
<span class="linenos">10</span><span class="n">df</span><span class="o">&lt;-</span><span class="n">s.loadings</span><span class="o">%&gt;%</span><span class="n">dplyr</span><span class="o">::</span><span class="nf">left_join</span><span class="p">(</span><span class="n">gene_stats</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;ensembl_gene_id&#39;</span><span class="p">,</span><span class="s">&#39;symbol&#39;</span><span class="p">)],</span><span class="n">by</span><span class="o">=</span><span class="s">&#39;ensembl_gene_id&#39;</span><span class="p">)</span>
<span class="linenos">11</span><span class="nf">rownames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">&lt;-</span><span class="n">df</span><span class="o">$</span><span class="n">ensembl_gene_id</span>
<span class="linenos">12</span><span class="n">df</span><span class="o">&lt;-</span><span class="n">df</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="n">gsc_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GSEABase</span><span class="o">::</span><span class="nf">getGmt</span><span class="p">(</span><span class="s">&quot;C:\\Users\\我的电脑\\Desktop\\待办\\c5.go.v2022.1.Hs.symbols.gmt&quot;</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span>
<span class="linenos">17</span><span class="n">gene_stat</span><span class="o">&lt;-</span><span class="nf">set_names</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="n">i</span><span class="p">],</span><span class="n">df</span><span class="o">$</span><span class="n">symbol</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="n">cPCA_GSEA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">run_fGSEA</span><span class="p">(</span><span class="n">gsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsc_data</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">                    </span><span class="n">gene_stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gene_stat</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">                    </span><span class="n">nperm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1e5</span><span class="p">,</span>
<span class="linenos">22</span><span class="w">                    </span><span class="n">perm_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;gene&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="linenos">23</span><span class="n">dplyr</span><span class="o">::</span><span class="nf">arrange</span><span class="p">(</span><span class="n">dplyr</span><span class="o">::</span><span class="nf">desc</span><span class="p">(</span><span class="n">NES</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="linenos">24</span><span class="n">dplyr</span><span class="o">::</span><span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">leadingEdge</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="n">cPCA_GSEA_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbind.data.frame</span><span class="p">(</span><span class="n">cPCA_GSEA</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">arrange</span><span class="p">(</span><span class="n">dplyr</span><span class="o">::</span><span class="nf">desc</span><span class="p">(</span><span class="n">NES</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">(</span><span class="m">8</span><span class="p">))</span>
<span class="linenos">27</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pathway</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pathway</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pathway</span><span class="p">)</span>
<span class="linenos">28</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pathway</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pathway</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pathway</span><span class="p">))</span>
<span class="linenos">29</span><span class="n">cPCA_GSEA_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="p">)</span>
<span class="linenos">30</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">signif</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">pval</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="linenos">31</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">`adjusted pval`</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">signif</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">padj</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="linenos">32</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">NES</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">signif</span><span class="p">(</span><span class="n">cPCA_GSEA_data</span><span class="o">$</span><span class="n">NES</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="n">cPCA_1</span><span class="o">&lt;-</span><span class="n">cPCA_GSEA_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;NES&#39;</span><span class="p">,</span><span class="s">&#39;pval&#39;</span><span class="p">)]</span>
<span class="linenos">35</span><span class="nf">colnames</span><span class="p">(</span><span class="n">cPCA_1</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;cPCA salient feature 1 NES&#39;</span><span class="p">,</span><span class="s">&#39;cPCA salient feature 1 pval&#39;</span><span class="p">)</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="n">cPCA_2</span><span class="o">&lt;-</span><span class="n">cPCA_GSEA_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;NES&#39;</span><span class="p">,</span><span class="s">&#39;pval&#39;</span><span class="p">)]</span>
<span class="linenos">38</span><span class="nf">colnames</span><span class="p">(</span><span class="n">cPCA_2</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;cPCA salient feature 2 NES&#39;</span><span class="p">,</span><span class="s">&#39;cPCA salient feature 2 pval&#39;</span><span class="p">)</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="n">cLDVAE_1</span><span class="o">&lt;-</span><span class="n">cPCA_GSEA_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;NES&#39;</span><span class="p">,</span><span class="s">&#39;pval&#39;</span><span class="p">)]</span>
<span class="linenos">41</span><span class="nf">colnames</span><span class="p">(</span><span class="n">cLDVAE_1</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;cLDVAE salient feature 1 NES&#39;</span><span class="p">,</span><span class="s">&#39;cLDVAE salient feature 1 pval&#39;</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span><span class="n">cLDVAE_2</span><span class="o">&lt;-</span><span class="n">cPCA_GSEA_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;NES&#39;</span><span class="p">,</span><span class="s">&#39;pval&#39;</span><span class="p">)]</span>
<span class="linenos">44</span><span class="nf">colnames</span><span class="p">(</span><span class="n">cLDVAE_2</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;pathway&#39;</span><span class="p">,</span><span class="s">&#39;cLDVAE salient feature 2 NES&#39;</span><span class="p">,</span><span class="s">&#39;cLDVAE salient feature 2 pval&#39;</span><span class="p">)</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="n">temp</span><span class="o">&lt;-</span><span class="n">cPCA_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">full_join</span><span class="p">(</span><span class="n">cPCA_2</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s">&quot;pathway&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">full_join</span><span class="p">(</span><span class="n">cLDVAE_1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s">&quot;pathway&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">full_join</span><span class="p">(</span><span class="n">cLDVAE_2</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s">&quot;pathway&quot;</span><span class="p">)</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="n">data</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">()</span>
<span class="linenos">49</span><span class="nf">for </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">temp</span><span class="o">$</span><span class="n">pathway</span><span class="p">){</span>
<span class="linenos">50</span><span class="nf">for </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;cPCA salient feature 1 NES&quot;</span><span class="p">,</span><span class="s">&quot;cPCA salient feature 2 NES&quot;</span><span class="p">,</span><span class="s">&quot;cLDVAE salient feature 1 NES&quot;</span><span class="p">,</span><span class="s">&quot;cLDVAE salient feature 2 NES&quot;</span><span class="p">)){</span>
<span class="linenos">51</span><span class="w">    </span><span class="nf">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">temp</span><span class="o">$</span><span class="n">pathway</span><span class="o">==</span><span class="n">p</span><span class="p">,</span><span class="n">f</span><span class="p">])){</span>
<span class="linenos">52</span><span class="w">    </span><span class="n">add</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">temp</span><span class="p">[</span><span class="n">temp</span><span class="o">$</span><span class="n">pathway</span><span class="o">==</span><span class="n">p</span><span class="p">,</span><span class="n">f</span><span class="p">])</span>
<span class="linenos">53</span><span class="w">    </span><span class="n">data</span><span class="o">&lt;-</span><span class="nf">rbind</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">add</span><span class="p">)</span>
<span class="linenos">54</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">55</span><span class="p">}</span>
<span class="linenos">56</span><span class="p">}</span>
<span class="linenos">57</span><span class="n">data</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="linenos">58</span><span class="nf">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;pathway&quot;</span><span class="p">,</span><span class="s">&quot;feature&quot;</span><span class="p">,</span><span class="s">&quot;NES&quot;</span><span class="p">)</span>
<span class="linenos">59</span><span class="nf">for </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">pathway</span><span class="p">){</span>
<span class="linenos">60</span><span class="nf">for </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">feature</span><span class="p">){</span>
<span class="linenos">61</span><span class="w">    </span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">$</span><span class="n">pathway</span><span class="o">==</span><span class="n">p</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">feature</span><span class="o">==</span><span class="n">f</span><span class="p">),</span><span class="s">&quot;pval&quot;</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">temp</span><span class="p">[</span><span class="n">temp</span><span class="o">$</span><span class="n">pathway</span><span class="o">==</span><span class="n">p</span><span class="p">,</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="s">&quot;NES&quot;</span><span class="p">,</span><span class="s">&quot;pval&quot;</span><span class="p">)]</span>
<span class="linenos">62</span><span class="p">}</span>
<span class="linenos">63</span><span class="p">}</span>
<span class="linenos">64</span><span class="n">data</span><span class="o">$</span><span class="n">feature</span><span class="o">&lt;-</span><span class="nf">sapply</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">feature</span><span class="p">,</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">str_replace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NES&quot;</span><span class="p">,</span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">65</span><span class="n">data</span><span class="o">$</span><span class="n">NES</span><span class="o">&lt;-</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">NES</span><span class="p">)</span>
<span class="linenos">66</span>
<span class="linenos">67</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">pathway</span><span class="p">))</span><span class="o">+</span>
<span class="linenos">68</span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">pval</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">NES</span><span class="p">))</span><span class="o">+</span>
<span class="linenos">69</span><span class="nf">scale_color_continuous</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="s">&quot;#fff5ee&quot;</span><span class="p">,</span><span class="n">low</span><span class="o">=</span><span class="s">&quot;#8b0000&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="linenos">70</span><span class="c1">#scale_color_continuous(high=&quot;#FFFFCC&quot;,low=&quot;#FD6E32&quot;)+</span>
<span class="linenos">71</span><span class="c1">#scale_color_continuous(high=&quot;#55B0F5&quot;,low=&quot;#28547A&quot;)+</span>
<span class="linenos">72</span><span class="nf">theme_bw</span><span class="p">()</span><span class="o">+</span>
<span class="linenos">73</span><span class="nf">guides</span><span class="p">()</span><span class="o">+</span>
<span class="linenos">74</span><span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">9</span><span class="p">),</span>
<span class="linenos">75</span><span class="w">        </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">9</span><span class="p">))</span><span class="o">+</span>
<span class="linenos">76</span><span class="nf">scale_y_discrete</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">data</span><span class="o">$</span><span class="n">pathway</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/Biological_interpretability_GSEA.jpg" src="_images/Biological_interpretability_GSEA.jpg" />
</section>
<section id="scatter-plot-between-salient-features-and-tumor-purity-r">
<h2>Scatter plot between salient features and tumor purity (R)<a class="headerlink" href="#scatter-plot-between-salient-features-and-tumor-purity-r" title="Permalink to this heading"></a></h2>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="n">ann</span><span class="o">&lt;-</span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;C:\\Users\\我的电脑\\Desktop\\待办\\en[1000]_de[1000]_s2_z100_beta1_gamma-100_lr3e-6_4th_cLDVAE_mnn_k1_80_k2_100_comb_Ann_agg0.612_time2023-03-23 01_50_42.573336.csv&#39;</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="n">tg_s</span><span class="o">&lt;-</span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;C:\\Users\\我的电脑\\Desktop\\待办\\en[1000]_de[1000]_cLDVAE_only_TCGA_salient_features_lr3e-06_beta1_gamma-100_bs128_dim2_time2023-03-22 12_31_29.044376.csv&#39;</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="n">tg_s_cPCA</span><span class="o">&lt;-</span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;C:\\Users\\我的电脑\\Desktop\\待办\\cPCA_only_salient_features_s2_z100 2023-03-23 02_19_53 .csv&#39;</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="nf">colnames</span><span class="p">(</span><span class="n">tg_s</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="s">&#39;sampleID&#39;</span>
<span class="linenos"> 6</span><span class="nf">colnames</span><span class="p">(</span><span class="n">tg_s_cPCA</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="s">&#39;sampleID&#39;</span>
<span class="linenos"> 7</span><span class="n">tumor_ann</span><span class="o">&lt;-</span><span class="n">ann</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ann</span><span class="o">$</span><span class="n">purity</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ann</span><span class="o">$</span><span class="n">type</span><span class="o">==</span><span class="s">&#39;tumor&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tg_s</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">inner_join</span><span class="p">(</span><span class="n">tumor_ann</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;sampleID&#39;</span><span class="p">,</span><span class="s">&#39;purity&#39;</span><span class="p">)],</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;sampleID&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="nf">left_join</span><span class="p">(</span><span class="n">tg_s_cPCA</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s">&#39;sampleID&#39;</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">purity</span><span class="o">&lt;-</span><span class="n">df</span><span class="o">$</span><span class="n">purity</span>
<span class="linenos">12</span><span class="n">salients</span><span class="o">&lt;-</span><span class="n">df</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;s1&#39;</span><span class="p">,</span><span class="s">&#39;s2&#39;</span><span class="p">,</span><span class="s">&#39;PC1&#39;</span><span class="p">,</span><span class="s">&#39;PC2&#39;</span><span class="p">)]</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="nf">library</span><span class="p">(</span><span class="n">lars</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="n">model.lasso</span><span class="o">&lt;-</span><span class="nf">lars</span><span class="p">(</span><span class="nf">as.matrix</span><span class="p">(</span><span class="n">salients</span><span class="p">),</span><span class="n">purity</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s">&#39;lasso&#39;</span><span class="p">)</span>
<span class="linenos">17</span><span class="nf">plot</span><span class="p">(</span><span class="n">model.lasso</span><span class="p">)</span>
<span class="linenos">18</span><span class="c1">#summary(model.lasso)</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="n">cv.model.lasso</span><span class="o">&lt;-</span><span class="nf">cv.lars</span><span class="p">(</span><span class="nf">as.matrix</span><span class="p">(</span><span class="n">salients</span><span class="p">),</span><span class="n">purity</span><span class="p">,</span><span class="n">K</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="linenos">21</span><span class="n">select</span><span class="o">&lt;-</span><span class="n">cv.model.lasso</span><span class="o">$</span><span class="n">index</span><span class="p">[</span><span class="nf">which.min</span><span class="p">(</span><span class="n">cv.model.lasso</span><span class="o">$</span><span class="n">cv</span><span class="p">)]</span>
<span class="linenos">22</span><span class="n">coef</span><span class="o">&lt;-</span><span class="nf">coef.lars</span><span class="p">(</span><span class="n">model.lasso</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;fraction&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
<span class="linenos">23</span><span class="n">coef</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">coef</span><span class="o">!=</span><span class="m">0</span><span class="p">)]</span>
<span class="linenos">24</span><span class="n">coef</span><span class="p">[</span><span class="nf">which.min</span><span class="p">(</span><span class="n">coef</span><span class="p">)]</span>
<span class="linenos">25</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="n">p4</span><span class="o">&lt;-</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">salients</span><span class="p">,</span>
<span class="linenos">28</span><span class="w">                </span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">aes</span><span class="p">(</span><span class="n">salients</span><span class="p">[,</span><span class="s">&#39;PC2&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">purity</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">29</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&#39;#EFD092&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">30</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">ylab</span><span class="p">(</span><span class="s">&#39;Tumor purity estimate&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">31</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">xlab</span><span class="p">(</span><span class="s">&#39;Salient feature 2&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">32</span><span class="n">ggpubr</span><span class="o">::</span><span class="nf">stat_cor</span><span class="p">(</span><span class="n">label.y.npc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;bottom&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">33</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;lm&#39;</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&#39;Red&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">34</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">35</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
<span class="linenos">36</span><span class="w">                </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
<span class="linenos">37</span><span class="w">                </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
<span class="linenos">38</span><span class="w">                </span><span class="n">axis.line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.1</span><span class="p">))</span>
</pre></div>
</div>
<img alt="_images/Biological_interpretability_scatter.jpg" src="_images/Biological_interpretability_scatter.jpg" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Alignment%20of%20Tumors%20and%20Cell%20Lines.html" class="btn btn-neutral float-left" title="Alignment of Tumors and Cell Lines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Integrating%20ST%20and%20scRNA-seq%20Data.html" class="btn btn-neutral float-right" title="Step0: Loading packages (Python)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, JunjieXia.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>